<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYMF Print | Sublimación y Estampados Profesionales</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Librería para Captura de pantalla (Capturar el diseño final) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Configuración para usar la fuente Inter y un esquema de color personalizado -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        // Paleta de Celeste Pastel
                        'primary': '#4FC3F7', // Celeste Vívido (Para botones y acentos fuertes)
                        'secondary': '#FFD54F', // Amarillo Suave (Contraste cálido)
                        'dark-bg': '#263238', // Gris Azulado Oscuro (Fondo de sección)
                    },
                    // Definición de animaciones y keyframes
                    keyframes: {
                        pulseShadow: {
                            '0%, 100%': { boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)' },
                            '50%': { boxShadow: '0 10px 15px -3px rgba(79, 195, 247, 0.5), 0 4px 6px -4px rgba(79, 195, 247, 0.5)' },
                        },
                        subtlePulse: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.02)' },
                        },
                        // Animación para el icono de carga (spin)
                        spin: {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' },
                        }
                    },
                    animation: {
                        'pulse-shadow': 'pulseShadow 2s infinite ease-in-out',
                        'subtle-pulse': 'subtlePulse 4s infinite ease-in-out',
                        'spin': 'spin 1s linear infinite',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados */
        .input-focus:focus {
            box-shadow: 0 0 0 2px #4FC3F7; /* Anillo de enfoque primario (Celeste) */
        }
        
        /* Estilo necesario para que el mapa ocupe el espacio */
        #contactMap {
            width: 100%;
            height: 100%;
        }

        /* Habilitar la interacción directa para el arrastre y zoom */
        #designOverlay {
            pointer-events: auto; /* Permite arrastrar y hacer zoom */
            cursor: grab;
            touch-action: none; /* Previene el comportamiento por defecto del scroll/zoom del navegador en móvil */
            transition: all 0.1s linear; /* Animación para un ajuste más suave */
        }
        #designOverlay:active {
            cursor: grabbing;
        }

        #customizerModal::-webkit-scrollbar {
            width: 8px;
        }

        #customizerModal::-webkit-scrollbar-thumb {
            background-color: #4FC3F7;
            border-radius: 10px;
        }
        
        /* Contenedor forzando un aspecto 1:1 para los placeholders de color */
        .product-base {
            width: 100%;
            position: relative; 
            border-radius: 0.75rem; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 4px solid #f9fafb;
        }

        /* Clase para Camisetas (ej. 4:5 - más vertical) */
        .aspect-ratio-portrait {
            padding-top: 125%; 
        }

        /* Clase para Tazas (ej. 1:1 - cuadrada) */
        .aspect-ratio-square {
            padding-top: 100%; 
        }

        .product-base-inner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border-radius: 0.5rem; 
        }
        
        /* Asegurar que el contenedor del diseño no se mueva con el scroll/zoom del navegador */
        #previewBox {
            max-width: 350px; 
            min-height: 400px;
        }
        
        .hidden-file-input {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }

        /* Animación de apertura del modal */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-open-animation {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* Estilo para el efecto de sombra del botón de WhatsApp */
        .whatsapp-button:hover {
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.8);
            transform: scale(1.05); /* Ligeramente más grande */
        }
        
        /* Estilos para el menú móvil - transiciones suaves */
        #mobileMenu {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        #mobileMenu.active {
            max-height: 500px; /* Suficiente altura para el contenido */
            opacity: 1;
        }
        
        /* Estilos para la guía de talles (Inicialmente oculta y animada) */
        #sizeGuideTable {
            transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out, padding 0.5s ease-in-out;
            max-height: 0;
            opacity: 0;
            padding: 0 1rem;
            overflow: hidden;
        }
        #sizeGuideTable.active {
            max-height: 500px; /* Suficiente altura */
            opacity: 1;
            padding: 1rem; /* Padding original */
        }
    </style>
</head>

<body class="font-sans text-gray-800 bg-gray-50 antialiased">

    <!-- Navbar - Fondo oscuro para el estilo del logo -->
    <header class="sticky top-0 z-50 bg-dark-bg shadow-lg">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <!-- LOGO CON ANIMACIÓN AL HOVER -->
            <a href="#" class="text-3xl font-extrabold tracking-tight flex items-center hover:scale-[1.03] transition duration-300">
                <span class="text-white">SYMF</span>
                <span class="text-primary ml-2 hover:text-secondary transition duration-300">Print</span>
            </a>
            
            <!-- Enlaces de navegación (Desktop) -->
            <div class="hidden md:flex space-x-8">
                <a href="#inicio" class="text-gray-200 hover:text-primary transition duration-300 font-medium hover:scale-105">Inicio</a>
                <a href="#servicios" class="text-gray-200 hover:text-primary transition duration-300 font-medium hover:scale-105">Servicios</a>
                <a href="#" onclick="openCustomizer(event)" class="text-gray-200 hover:text-primary transition duration-300 font-medium hover:scale-105">Diseña Ahora</a>
                <a href="#galeria" class="text-gray-200 hover:text-primary transition duration-300 font-medium hover:scale-105">Galería</a>
                <a href="#contacto" class="text-dark-bg bg-secondary py-2 px-4 rounded-full hover:bg-yellow-300 transition duration-300 font-medium shadow-lg hover:shadow-xl hover:scale-105">Contacto</a>
            </div>
            
            <!-- Botón de Menú (Mobile) - Añadido ID y onclick -->
            <button id="mobileMenuButton" onclick="toggleMobileMenu()" class="md:hidden p-2 text-primary hover:text-sky-600 transition duration-300 rounded-lg font-bold">
                <svg id="menuIcon" xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                <svg id="closeIcon" xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x hidden"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </nav>
        
        <!-- Menú Móvil Desplegable (Hidden por defecto en desktop) -->
        <div id="mobileMenu" class="md:hidden bg-dark-bg/90 border-t border-primary/20">
            <div class="pt-2 pb-3 space-y-1 px-4 sm:px-6">
                <!-- Los enlaces ahora tienen un evento onClick para cerrar el menú al hacer clic -->
                <a href="#inicio" onclick="toggleMobileMenu()" class="block text-gray-200 hover:bg-primary/20 hover:text-primary transition duration-300 font-medium py-2 px-3 rounded-lg">Inicio</a>
                <a href="#servicios" onclick="toggleMobileMenu()" class="block text-gray-200 hover:bg-primary/20 hover:text-primary transition duration-300 font-medium py-2 px-3 rounded-lg">Servicios</a>
                <a href="#" onclick="openCustomizer(event); toggleMobileMenu();" class="block text-gray-200 hover:bg-primary/20 hover:text-primary transition duration-300 font-medium py-2 px-3 rounded-lg">Diseña Ahora</a>
                <a href="#galeria" onclick="toggleMobileMenu()" class="block text-gray-200 hover:bg-primary/20 hover:text-primary transition duration-300 font-medium py-2 px-3 rounded-lg">Galería</a>
                <a href="#contacto" onclick="toggleMobileMenu()" class="block text-dark-bg bg-secondary hover:bg-yellow-300 transition duration-300 font-medium py-2 px-3 rounded-lg text-center mt-2">Contacto</a>
            </div>
        </div>
    </header>

    <main>
        <!-- Sección Hero (Inicio) -->
        <section id="inicio" class="relative bg-dark-bg text-white pt-20 pb-28 md:pt-32 md:pb-40 overflow-hidden">
            <div class="absolute inset-0 opacity-10 bg-repeat" style="background-image: linear-gradient(45deg, rgba(79, 195, 247, 0.1) 25%, transparent 25%, transparent 75%, rgba(79, 195, 247, 0.1) 75%, rgba(79, 195, 247, 0.1)); background-size: 50px 50px;"></div>

            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 flex flex-col md:flex-row items-center">
                <div class="md:w-1/2 text-center md:text-left mb-10 md:mb-0">
                    <h1 class="text-5xl md:text-6xl font-extrabold leading-tight mb-4 tracking-tighter">
                        Tu Idea, <span class="text-secondary block md:inline">Nuestra Estampa.</span>
                    </h1>
                    <p class="text-xl text-gray-300 mb-8 max-w-lg mx-auto md:mx-0">
                        Convertimos tus diseños en productos memorables. Expertos en sublimación de alta definición y estampados duraderos.
                    </p>
                    <a href="#" onclick="openCustomizer(event)" class="inline-block bg-secondary text-dark-bg font-bold py-3 px-8 rounded-full text-lg hover:bg-yellow-300 transition duration-300 transform hover:scale-105 shadow-xl animate-pulse-shadow">
                        Empieza a Diseñar
                    </a>
                </div>
                <div class="md:w-1/2 flex justify-center">
                    <div class="w-64 h-64 md:w-96 md:h-96 rounded-3xl shadow-2xl transform rotate-3 hover:rotate-0 transition duration-500 ease-in-out border-4 border-secondary/50 max-w-full flex items-center justify-center bg-primary text-dark-bg text-2xl font-bold animate-subtle-pulse">
                        Tu Diseño Aquí
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Servicios -->
        <section id="servicios" class="py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-4xl font-bold text-gray-900 mb-4">Nuestros Servicios Clave</h2>
                <p class="text-xl text-gray-600 mb-12">Calidad, color y precisión en cada técnica que dominamos.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                    <!-- TARJETA 1 con animación de elevación sutil -->
                    <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition duration-500 transform hover:-translate-y-2 border-t-4 border-primary/50">
                        <h3 class="text-2xl font-semibold mb-3 pt-4">Sublimación de Alta Definición</h3>
                        <p class="text-gray-600">Ideal para textiles de poliéster y productos promocionales. Colores vibrantes, permanentes y que no se sienten al tacto. Perfecto para diseños complejos.</p>
                    </div>
                    <!-- TARJETA 2 con animación de elevación sutil -->
                    <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition duration-500 transform hover:-translate-y-2 border-t-4 border-primary/50">
                        <h3 class="text-2xl font-semibold mb-3 pt-4">Estampado con Vinilo Termotransferible</h3>
                        <p class="text-gray-600">Acabados con textura, efectos especiales (glitter, metálicos) y gran opacidad. Excelente para algodón y prendas de trabajo o deportivas de alta resistencia.</p>
                    </div>
                    <!-- TARJETA 3 con animación de elevación sutil -->
                    <div class="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition duration-500 transform hover:-translate-y-2 border-t-4 border-primary/50">
                        <h3 class="text-2xl font-semibold mb-3 pt-4">Asesoría y Diseño Gráfico</h3>
                        <p class="text-gray-600">¿No tienes el diseño listo? Nuestro equipo te asesora o crea el arte final desde cero, garantizando que el resultado impreso sea perfecto y listo para producción.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Galería/Portfolio -->
        <section id="galeria" class="py-20 bg-gray-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-4xl font-bold text-gray-900 mb-4">Proyectos que Nos Inspiran</h2>
                <p class="text-xl text-gray-600 mb-12">Mira la calidad y el detalle que ponemos en cada pedido.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="relative group overflow-hidden rounded-xl shadow-lg hover:shadow-2xl transition duration-300 transform hover:scale-[1.02] bg-primary h-64 flex items-center justify-center">
                        <div class="absolute inset-0 bg-primary/70 opacity-100 flex items-center justify-center">
                            <p class="text-white text-xl font-bold">Tazas Premium</p>
                        </div>
                    </div>
                    <div class="relative group overflow-hidden rounded-xl shadow-lg hover:shadow-2xl transition duration-300 transform hover:scale-[1.02] bg-secondary h-64 flex items-center justify-center">
                        <div class="absolute inset-0 bg-secondary/70 opacity-100 flex items-center justify-center">
                            <p class="text-dark-bg text-xl font-bold">Remeras Full Color</p>
                        </div>
                    </div>
                    <div class="relative group overflow-hidden rounded-xl shadow-lg hover:shadow-2xl transition duration-300 transform hover:scale-[1.02] bg-blue-500 h-64 flex items-center justify-center">
                        <div class="absolute inset-0 bg-blue-500/70 opacity-100 flex items-center justify-center">
                            <p class="text-white text-xl font-bold">Gorras de Marca</p>
                        </div>
                    </div>
                    <div class="relative group overflow-hidden rounded-xl shadow-lg hover:shadow-2xl transition duration-300 transform hover:scale-[1.02] bg-emerald-500 h-64 flex items-center justify-center">
                        <div class="absolute inset-0 bg-emerald-500/70 opacity-100 flex items-center justify-center">
                            <p class="text-white text-xl font-bold">Merchandising</p>
                        </div>
                    </div>
                </div>
                <a href="#contacto" onclick="closeCustomizer()" class="mt-12 inline-block text-lg font-semibold text-primary hover:text-sky-600 transition duration-300 border-b-2 border-primary hover:border-sky-600 hover:scale-105">Ver más trabajos →</a>
            </div>
        </section>

        <!-- Sección de Ubicación y Contacto con MAPA GOOGLE MAPS -->
        <section id="ubicacion" class="py-20 bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-4xl font-bold text-gray-900 mb-4">Encuéntranos en Tarragona</h2>
                <p class="text-xl text-gray-600 mb-8">Estamos cerca de la histórica Tarraco Arena (Antigua Plaza de Toros).</p>
                
                <!-- CONTENEDOR DEL MAPA (ID: contactMap) -->
                <div class="rounded-2xl overflow-hidden shadow-2xl border-4 border-primary w-full max-w-4xl mx-auto" style="height: 400px;">
                     <div id="contactMap">
                         <!-- El mapa de Google Maps se cargará aquí -->
                         <div id="mapLoader" class="w-full h-full flex items-center justify-center bg-gray-200/50 p-8 text-center">
                             <div class="text-gray-700">Cargando Mapa...</div>
                         </div>
                     </div>
                </div>

            </div>
        </section>

        <!-- Sección de Contacto -->
        <section id="contacto" class="py-20 bg-dark-bg text-white">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold text-white mb-4">¡Empecemos tu Proyecto!</h2>
                    <p class="text-xl text-gray-300">Cuéntanos tu idea. Te responderemos con una cotización detallada en menos de 24 horas.</p>
                    
                    <!-- BOTÓN DE WHATSAPP con el icono de usuario y ANIMACIÓN PULSADA -->
                    <a href="https://wa.me/5491100000000?text=Hola,%20me%20interesa%20una%20cotización%20de%20sublimación." target="_blank" class="whatsapp-button inline-flex items-center justify-center mt-6 mb-10 bg-green-500 text-white font-bold py-3 px-8 rounded-full text-lg transition duration-300 transform hover:scale-105 shadow-xl hover:bg-green-600">
                        <!-- IMAGEN DE WHATSAPP (Archivo Propio) -->
                        <img src="whatsapp-icon.png" alt="Icono de WhatsApp" class="w-6 h-6 mr-3">
                        Contactar Directo por WhatsApp
                    </a>
                </div>

                <div class="bg-white p-8 md:p-10 rounded-2xl shadow-2xl">
                    <!-- FORMULARIO CON EL CORREO ACTUALIZADO -->
                    <form id="contactForm" action="https://formsubmit.co/ellsanty123@gmail.com" method="POST" class="space-y-6" onsubmit="return submitFormWithDesign(event)">
                        
                        <!-- Campo oculto para definir el asunto del email -->
                        <input type="hidden" name="_subject" value="Nueva Solicitud de Cotización (SYMF Print)">
                        
                        <!-- CAMPO OCULTO PARA LA IMAGEN DEL DISEÑO (Base64) -->
                        <input type="hidden" name="design_image_url" id="designImageUrl">
                        
                        <!-- Campos de Producto y Talle/Color seleccionados (Para facilitar la cotización) -->
                        <input type="hidden" name="selected_product" id="selectedProductInput">
                        <input type="hidden" name="selected_size_color" id="selectedSizeColorInput">

                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
                            <input type="text" id="name" name="name" required class="input-focus mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 transition duration-150">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico</label>
                            <input type="email" id="email" name="email" required class="input-focus mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 transition duration-150">
                        </div>
                        <div>
                            <label for="message" class="block text-sm font-medium text-gray-700 mb-1">Detalles del Proyecto (Cantidad, Tipo de Producto, Diseño)</label>
                            <textarea id="message" name="message" rows="4" required class="input-focus mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 transition duration-150"></textarea>
                        </div>
                        <button type="submit" id="submitButton" class="w-full bg-primary text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-600 transition duration-300 transform hover:scale-[1.01] shadow-lg hover:shadow-xl flex items-center justify-center">
                            <svg id="submitSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span id="submitButtonText">Enviar Solicitud de Cotización</span>
                        </button>
                    </form>
                    <div id="loadingStatus" class="mt-4 text-center text-primary font-semibold hidden">
                        Generando vista previa del diseño... por favor, espera un momento.
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm text-gray-400">&copy; 2024 SYMF Print. Todos los derechos reservados.</p>
            <div class="mt-2 text-sm">
                <a href="#contacto" class="text-primary hover:text-secondary transition duration-300">Contáctanos</a> | 
                <span class="text-gray-500">Diseñado con ❤️ en Tarragona</span>
            </div>
        </div>
    </footer>

    <!-- MODAL DEL PERSONALIZADOR (Fuera de <main> y oculto) -->
    <div id="customizerModal" class="fixed inset-0 z-[100] bg-dark-bg/95 backdrop-blur-sm hidden overflow-y-auto transition-opacity duration-300 opacity-0">
        <div class="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
            <div class="bg-gray-50 p-6 md:p-8 rounded-3xl shadow-2xl relative modal-open-animation">
                
                <!-- Botón de Cierre -->
                <button onclick="closeCustomizer()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-900 transition duration-300 p-2 rounded-full bg-white shadow-lg z-20 hover:scale-110">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-circle"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                </button>

                <div class="text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Diseña tu Producto al Instante</h2>
                    <p class="text-lg md:text-xl text-gray-600 mb-8">Arrastra, pellizca o usa la rueda para ajustar tu diseño.</p>
                </div>

                <!-- Contenedor Responsive: Vista Previa arriba en móvil, Controles abajo -->
                <div class="flex flex-col lg:flex-row gap-8 lg:gap-12 items-start max-w-5xl mx-auto">
                    
                    <!-- Columna de Vista Previa (3/5 en desktop, 1/1 en mobile - orden 1) -->
                    <div class="lg:w-3/5 w-full order-1 lg:order-2 bg-white p-4 md:p-6 rounded-2xl shadow-xl flex justify-center items-center">
                        <div id="previewBox" class="relative w-full mx-auto max-w-sm transition-all duration-300 bg-gray-100 rounded-xl p-4 shadow-inner">
                            <div id="productBaseContainer" class="product-base aspect-ratio-portrait bg-white">
                                <!-- IMAGEN BASE (MOCKUP) CON RUTA RELATIVA: './images/camiseta_blanca.jpg' -->
                                <img id="baseProductImage" 
                                    src="camiseta_blanca.jpg" 
                                    alt="Camiseta Blanca Personalizada" 
                                    class="product-base-inner w-full h-full object-cover transition-opacity duration-300"
                                    onerror="this.style.opacity = '0'; document.getElementById('baseColorPlaceholder').classList.remove('hidden'); document.getElementById('productMockupIcon').setAttribute('data-product', 'Camiseta'); updateProductBaseColor('Blanca');"
                                >
                                
                                <!-- Placeholder de Color (Solo visible si no hay imagen de mockup o si falla la carga) -->
                                <div id="baseColorPlaceholder" class="product-base-inner hidden bg-gray-50">
                                    <div class="product-base-inner">
                                        <!-- Icono Lucide para un mockup genérico -->
                                        <svg xmlns="http://www.w3.org/2000/svg" id="productMockupIcon" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shirt mb-2 text-gray-400"><path d="M20.3 3.3a2 2 0 0 0-2.6.4l-4.2 3.8L9 3.7c-.5-.4-1-.7-1.7-.7s-1.2.3-1.7.7L2.3 8.2a2 2 0 0 0-.4 2.6l4.2 3.8V21a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-6.4l4.2-3.8a2 2 0 0 0-.4-2.6z"/></svg>
                                        <p class="text-xl font-bold" id="placeholderText">Camiseta Blanca</p>
                                        <p class="text-sm">(Mockup de Color Genérico)</p>
                                    </div>
                                </div>
                                
                                <!-- Capa de Diseño (Overlay) -->
                                <img id="designOverlay" src="" alt="Tu Diseño de Sublimación" 
                                    class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 transition-all duration-100 ease-linear opacity-0 z-10" 
                                    style="width: 150px; height: auto; user-select: none;"
                                >
                                
                                <!-- Mensaje para subir diseño -->
                                <div id="designPrompt" class="absolute inset-0 flex items-center justify-center text-gray-400 font-semibold bg-white/70 rounded-xl transition duration-300">
                                    Sube un diseño para verlo aquí
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Columna de Controles (2/5 en desktop, 1/1 en mobile - orden 2) -->
                    <div class="lg:w-2/5 w-full order-2 lg:order-1 bg-white p-6 md:p-8 rounded-2xl shadow-xl border border-gray-200 text-left">
                        
                        <!-- 1. Producto y Color -->
                        <h3 class="text-2xl font-semibold mb-4 text-gray-900">1. Producto y Color</h3>
                        
                        <!-- Selector de Producto -->
                        <label class="block text-gray-700 font-medium mb-2">Selecciona el Producto</label>
                        <div class="flex space-x-4 mb-6">
                            <label class="inline-flex items-center">
                                <input type="radio" name="productType" value="Camiseta" checked onchange="updateProductView()" class="form-radio text-primary h-5 w-5 border-gray-300 focus:ring-primary rounded-full">
                                <span class="ml-2 text-gray-700 font-medium">Camiseta</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="productType" value="Taza" onchange="updateProductView()" class="form-radio text-primary h-5 w-5 border-gray-300 focus:ring-primary rounded-full">
                                <span class="ml-2 text-gray-700 font-medium">Taza</span>
                            </label>
                        </div>

                        <!-- Selector de Color -->
                        <label class="block text-gray-700 font-medium mb-2">Selecciona el Color</label>
                        <div class="flex space-x-4 mb-6">
                            <label class="inline-flex items-center">
                                <input type="radio" id="colorWhite" name="productColor" value="Blanca" checked onchange="updateProductView()" class="form-radio text-primary h-5 w-5 border-gray-300 focus:ring-primary rounded-full">
                                <span class="ml-2 text-gray-700 font-medium">Blanco</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" id="colorBlack" name="productColor" value="Negra" onchange="updateProductView()" class="form-radio text-primary h-5 w-5 border-gray-300 focus:ring-primary rounded-full">
                                <span class="ml-2 text-gray-700 font-medium">Negro</span>
                            </label>
                        </div>

                        <!-- 2. Sube tu Diseño -->
                        <h3 class="text-2xl font-semibold mt-8 mb-4 text-gray-900">2. Sube y Ajusta</h3>
                        
                        <input type="file" id="designUpload" accept="image/*" class="hidden-file-input">
                        
                        <label for="designUpload" class="w-full inline-flex items-center justify-center bg-primary text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-600 transition duration-300 shadow-md cursor-pointer hover:scale-[1.01]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                            Seleccionar Archivo de Imagen
                        </label>

                        <p id="uploadStatus" class="mt-4 text-sm text-gray-500 hidden"></p>

                        <!-- Mensaje de instrucción de interacción táctil -->
                        <div id="interactionGuide" class="mt-4 p-3 bg-primary/10 border border-primary/30 rounded-lg text-sm text-gray-700 font-medium hidden">
                            <p class="font-bold text-primary mb-1">¡Consejo de Diseño!</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>**Móvil:** Arrastra con un dedo para mover. Pellizca con dos dedos para cambiar tamaño.</li>
                                <li>**Desktop:** Arrastra con el ratón. Usa la rueda para cambiar tamaño.</li>
                            </ul>
                        </div>
                        
                        <!-- 3. Talle (Condicional) -->
                        <div id="shirtSizeSelector" class="transition-all duration-300 ease-in-out overflow-hidden mt-8 max-h-[500px]">
                            <h3 class="text-2xl font-semibold mb-4 text-gray-900">3. Selecciona Talle</h3>
                            <div class="space-y-4">
                                <label for="shirtSize" class="block text-gray-700 font-medium mb-1">Talle de Camiseta</label>
                                <select id="shirtSize" class="w-full border border-gray-300 rounded-lg p-3 text-gray-700 bg-gray-50 input-focus transition duration-150">
                                    <option value="Talle S">S - Small</option>
                                    <option value="Talle M" selected>M - Medium</option>
                                    <option value="Talle L">L - Large</option>
                                    <option value="Talle XL">XL - Extra Large</option>
                                </select>
                                
                                <button onclick="toggleSizeGuide()" class="text-sm font-medium text-primary hover:text-sky-600 transition duration-300 mt-2 hover:underline">
                                    <span id="sizeGuideToggleText">Mostrar Guía de Talles</span>
                                </button>
                                
                                <!-- Guía de Talles Desplegable (Inicialmente oculta con la clase 'hidden') -->
                                <div id="sizeGuideTable" class="bg-gray-100 rounded-lg mt-3">
                                    <table class="w-full text-sm text-left text-gray-600">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-200 rounded-t-lg">
                                            <tr>
                                                <th scope="col" class="py-2 px-4">Talle</th>
                                                <th scope="col" class="py-2 px-4">Ancho (cm)</th>
                                                <th scope="col" class="py-2 px-4">Largo (cm)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b">
                                                <th scope="row" class="py-2 px-4 font-medium text-gray-900">S</th>
                                                <td class="py-2 px-4">48</td>
                                                <td class="py-2 px-4">68</td>
                                            </tr>
                                            <tr class="bg-gray-50 border-b">
                                                <th scope="row" class="py-2 px-4 font-medium text-gray-900">M</th>
                                                <td class="py-2 px-4">52</td>
                                                <td class="py-2 px-4">70</td>
                                            </tr>
                                            <tr class="bg-white">
                                                <th scope="row" class="py-2 px-4 font-medium text-gray-900">L</th>
                                                <td class="py-2 px-4">56</td>
                                                <td class="py-2 px-4">72</td>
                                            </tr>
                                            <tr class="bg-gray-50">
                                                <th scope="row" class="py-2 px-4 font-medium text-gray-900">XL</th>
                                                <td class="py-2 px-4">60</td>
                                                <td class="py-2 px-4">74</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Botón Final de Contacto desde el Personalizador -->
                        <a href="#contacto" onclick="closeCustomizerAndPrefill(event)" class="mt-8 w-full inline-flex items-center justify-center bg-secondary text-dark-bg font-bold py-3 px-4 rounded-lg hover:bg-yellow-300 transition duration-300 shadow-xl transform hover:scale-[1.01]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send-horizontal mr-2"><polyline points="21 12 17 8 17 16"/><line x1="3" x2="17" y1="12" y2="12"/></svg>
                            Enviar Diseño y Solicitar Cotización
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CARGA DE GOOGLE MAPS (LA CLAVE YA ESTÁ INCLUIDA) -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCILSQvZqz9G1XqFnDX54esJDmoedAC1YM&callback=initMap"></script>

    <!-- LÓGICA DE JAVASCRIPT CORREGIDA Y COMPLETA -->
    <script>
        // --- 1. CONFIGURACIÓN INICIAL DEL PERSONALIZADOR ---
        let scale = 1.0;
        let positionX = 0;
        let positionY = 0;
        let isDragging = false;
        let startX, startY;
        let activeProduct = 'Camiseta';
        let activeColor = 'Blanca';
        
        const overlay = document.getElementById('designOverlay');
        const container = document.getElementById('previewBox');
        const baseProductImage = document.getElementById('baseProductImage');
        const baseColorPlaceholder = document.getElementById('baseColorPlaceholder');
        const placeholderText = document.getElementById('placeholderText');
        const productBaseContainer = document.getElementById('productBaseContainer');

        const mockupUrls = {
            'Camiseta-Blanca': 'camiseta_blanca.jpg',
            // El resto usa el placeholder de color ya que las URLs reales faltan
            'Camiseta-Negra': 'camiseta_negra.jpg', 
            'Taza-Blanca': 'taza_blanca.jpg',
            'Taza-Negra': 'taza_negra.jpg',
        };

        // Función auxiliar para actualizar el estilo CSS del overlay
        function applyTransform() {
            overlay.style.transform = `translate(-50%, -50%) translate(${positionX}px, ${positionY}px) scale(${scale})`;
        }

        // --- 2. LÓGICA DE MANEJO DE DISEÑO (Arrastrar, Zoom, Subida) ---

        // Configuración de Eventos de Interacción (Mouse y Touch)
        function setupInteractionListeners() {
            // DRAG (Mouse Down/Touch Start)
            container.addEventListener('mousedown', startDrag);
            container.addEventListener('touchstart', startDrag);
            
            // ZOOM (Mouse Wheel)
            container.addEventListener('wheel', handleZoom);
        }

        function startDrag(e) {
            if (overlay.classList.contains('opacity-0')) return; // No arrastrar si no hay diseño
            e.preventDefault(); 
            isDragging = true;
            
            // Obtener coordenadas de inicio (maneja mouse o el primer toque)
            if (e.type === 'touchstart' && e.touches.length === 1) {
                startX = e.touches[0].clientX - positionX;
                startY = e.touches[0].clientY - positionY;
                overlay.style.cursor = 'grabbing';
                
                // Añadir listeners de movimiento y fin para móvil
                document.addEventListener('touchmove', handleDrag);
                document.addEventListener('touchend', endDrag);
                
            } else if (e.type === 'mousedown') {
                startX = e.clientX - positionX;
                startY = e.clientY - positionY;
                overlay.style.cursor = 'grabbing';
                
                // Añadir listeners de movimiento y fin para desktop
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('mouseup', endDrag);
            }
        }

        function handleDrag(e) {
            if (!isDragging) return;
            e.preventDefault();

            let currentX, currentY;
            if (e.type === 'touchmove' && e.touches.length === 1) {
                currentX = e.touches[0].clientX;
                currentY = e.touches[0].clientY;
            } else if (e.type === 'mousemove') {
                currentX = e.clientX;
                currentY = e.clientY;
            } else {
                return; // Ignorar toques múltiples (manejo de zoom/pinch)
            }

            // Calcular nuevas posiciones
            positionX = currentX - startX;
            positionY = currentY - startY;

            applyTransform();
        }

        function endDrag(e) {
            isDragging = false;
            overlay.style.cursor = 'grab';
            
            // Limpiar listeners
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchmove', handleDrag);
            document.removeEventListener('touchend', endDrag);
        }

        function handleZoom(e) {
            e.preventDefault();
            const delta = e.deltaY * -0.001; // Invertir y suavizar la rueda
            scale = Math.max(0.2, Math.min(3.0, scale + delta)); // Limitar escala entre 0.2 y 3.0
            applyTransform();
        }
        
        // Inicializar los listeners al cargar la página
        window.onload = setupInteractionListeners;

        // Manejo de la subida de archivos
        document.getElementById('designUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    overlay.src = event.target.result;
                    overlay.classList.remove('opacity-0');
                    document.getElementById('designPrompt').classList.add('hidden');
                    document.getElementById('interactionGuide').classList.remove('hidden');
                    
                    // Resetear posición y escala
                    scale = 1.0;
                    positionX = 0;
                    positionY = 0;
                    applyTransform();
                };
                reader.readAsDataURL(file);
                document.getElementById('uploadStatus').textContent = `Archivo cargado: ${file.name}`;
                document.getElementById('uploadStatus').classList.remove('hidden');
            }
        });


        // --- 3. LÓGICA DEL VISTAZO DE PRODUCTO Y COLOR ---
        
        function updateProductBaseColor(color) {
            const product = activeProduct;
            const element = baseColorPlaceholder.querySelector('.product-base-inner');
            const icon = document.getElementById('productMockupIcon');
            
            // Reiniciar clases de color
            element.className = 'product-base-inner';
            
            // Asignar fondo y texto según producto/color
            if (product === 'Camiseta') {
                icon.innerHTML = '<path d="M20.3 3.3a2 2 0 0 0-2.6.4l-4.2 3.8L9 3.7c-.5-.4-1-.7-1.7-.7s-1.2.3-1.7.7L2.3 8.2a2 2 0 0 0-.4 2.6l4.2 3.8V21a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-6.4l4.2-3.8a2 2 0 0 0-.4-2.6z"/>';
                placeholderText.textContent = `Camiseta ${color}`;
                if (color === 'Blanca') {
                    element.classList.add('bg-white', 'text-gray-900');
                } else { // Negra
                    element.classList.add('bg-gray-800', 'text-gray-200');
                }
            } else { // Taza
                 icon.innerHTML = '<rect width="18" height="10" x="3" y="2" rx="3"/><path d="M7 2h10c1.7 0 3 1.3 3 3v5c0 1.7-1.3 3-3 3h-2v3a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-3H7c-1.7 0-3-1.3-3-3V5c0-1.7 1.3-3 3-3z"/>'; // Icono de Taza Lucide (Mockup genérico)
                placeholderText.textContent = `Taza ${color}`;
                if (color === 'Blanca') {
                    element.classList.add('bg-white', 'text-gray-900');
                } else { // Negra
                    element.classList.add('bg-gray-900', 'text-gray-200');
                }
            }
        }

        function updateProductView() {
            activeProduct = document.querySelector('input[name="productType"]:checked').value;
            activeColor = document.querySelector('input[name="productColor"]:checked').value;
            
            const productKey = `${activeProduct}-${activeColor}`;
            
            // 1. Actualizar clase de aspecto
            productBaseContainer.classList.remove('aspect-ratio-portrait', 'aspect-ratio-square');
            if (activeProduct === 'Camiseta') {
                productBaseContainer.classList.add('aspect-ratio-portrait');
                document.getElementById('shirtSizeSelector').classList.remove('hidden');
            } else { // Taza
                productBaseContainer.classList.add('aspect-ratio-square');
                document.getElementById('shirtSizeSelector').classList.add('hidden');
            }

            // 2. Actualizar imagen de mockup o placeholder
            if (mockupUrls[productKey]) {
                baseProductImage.src = mockupUrls[productKey];
                // Intentar cargar la imagen, el onerror manejará el fallback al placeholder
                baseProductImage.style.opacity = '1';
                baseColorPlaceholder.classList.add('hidden');
                
            } else {
                // Forzar el uso del placeholder si la URL no está en la lista de mockups
                baseProductImage.style.opacity = '0';
                baseColorPlaceholder.classList.remove('hidden');
                updateProductBaseColor(activeColor); // Llama al handler del placeholder
            }
        }

        // --- 4. CONTROL DEL MODAL ---

        function openCustomizer(e) {
            e.preventDefault();
            document.getElementById('customizerModal').classList.remove('hidden');
            // Timeout para asegurar que la transición de opacidad se aplique correctamente
            setTimeout(() => {
                document.getElementById('customizerModal').classList.add('opacity-100');
            }, 10);
            updateProductView(); // Asegura que la vista se inicialice correctamente
        }

        function closeCustomizer() {
            document.getElementById('customizerModal').classList.remove('opacity-100');
            // Timeout para esperar que termine la transición antes de ocultar
            setTimeout(() => {
                document.getElementById('customizerModal').classList.add('hidden');
            }, 300);
        }

        // --- 5. LÓGICA DEL FORMULARIO DE CONTACTO ---

        function closeCustomizerAndPrefill(e) {
            e.preventDefault();
            
            // 1. Cierra el modal de diseño
            closeCustomizer();
            
            // 2. Selecciona la información del producto y talle
            const product = activeProduct;
            const color = activeColor;
            let sizeOrDetail = 'N/A';
            if (product === 'Camiseta') {
                sizeOrDetail = document.getElementById('shirtSize').value;
            }
            
            // 3. Rellena los campos ocultos del formulario de contacto
            document.getElementById('selectedProductInput').value = `${product} (${color})`;
            document.getElementById('selectedSizeColorInput').value = sizeOrDetail;

            // 4. Se asegura de que el mensaje tenga un valor inicial claro
            const messageField = document.getElementById('message');
            if (!messageField.value || messageField.value.trim() === '') {
                messageField.value = `¡Hola! Me gustaría cotizar este diseño para un(a) ${product} color ${color} ${sizeOrDetail.toLowerCase()}.`;
            }
            
            // 5. Scrolls hacia la sección de contacto
            setTimeout(() => {
                document.getElementById('contacto').scrollIntoView({ behavior: 'smooth' });
            }, 350);
        }
        
        // **FUNCIÓN CRÍTICA CORREGIDA:** Captura la imagen del diseño y luego envía el formulario.
        async function submitFormWithDesign(event) {
            event.preventDefault(); // Detiene el envío inicial
            
            const designUrl = overlay.src;
            const designImageUrlField = document.getElementById('designImageUrl');
            
            const submitButton = document.getElementById('submitButton');
            const submitButtonText = document.getElementById('submitButtonText');
            const submitSpinner = document.getElementById('submitSpinner');
            const loadingStatus = document.getElementById('loadingStatus');

            // Habilitar estado de carga
            submitButton.disabled = true;
            submitButtonText.textContent = 'Enviando...';
            submitSpinner.classList.remove('hidden');
            loadingStatus.classList.remove('hidden');
            
            // Si el usuario no subió diseño, envía directamente y salta html2canvas
            if (overlay.classList.contains('opacity-0') || !designUrl) {
                loadingStatus.textContent = 'No se detectó un diseño. Enviando solicitud de contacto...';
                
                // Asegura que el campo designImageUrl esté vacío
                designImageUrlField.value = '';
                
                // Envía el formulario directamente
                event.target.submit();
                return true;
            }

            loadingStatus.textContent = 'Generando vista previa del diseño... por favor, espera un momento.';
            
            try {
                // Capturar el contenedor de previsualización (producto + diseño)
                const canvas = await html2canvas(document.getElementById('productBaseContainer'), {
                    scale: 2, // Aumentar la escala para mejor resolución
                    useCORS: true, 
                    logging: false,
                    allowTaint: true 
                });

                // Convertir el canvas a URL Base64
                const base64Image = canvas.toDataURL('image/png');
                
                // Asignar la imagen Base64 al campo oculto del formulario
                designImageUrlField.value = base64Image;

                loadingStatus.textContent = 'Diseño capturado. Enviando formulario...';

                // Enviar el formulario
                event.target.submit();
                return true;
                
            } catch (error) {
                console.error("Error al capturar el canvas:", error);
                
                // Manejo de errores sin alert
                loadingStatus.textContent = 'Error al capturar el diseño. Por favor, envía la solicitud directamente y adjunta el archivo si es necesario.';
                designImageUrlField.value = 'ERROR_CAPTURA_FALLIDA'; 
                
                // Deshabilitar estado de carga (fallido)
                submitButton.disabled = false;
                submitButtonText.textContent = 'Enviar Solicitud de Cotización';
                submitSpinner.classList.add('hidden');
                
                // Permite el envío estándar (sin imagen)
                return false; 
            }
        }


        // --- 6. FUNCIONES DE UTILIDAD (Menú Móvil y Guía de Talles) ---
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const menuIcon = document.getElementById('menuIcon');
            const closeIcon = document.getElementById('closeIcon');
            
            if (menu.classList.contains('active')) {
                menu.classList.remove('active');
                menuIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
            } else {
                menu.classList.add('active');
                menuIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
            }
        }
        
        // **FUNCIÓN CRÍTICA CORREGIDA:** Alterna la visibilidad de la tabla de talles.
        function toggleSizeGuide() {
            const guide = document.getElementById('sizeGuideTable');
            const toggleText = document.getElementById('sizeGuideToggleText');
            
            if (guide.classList.contains('active')) {
                guide.classList.remove('active');
                toggleText.textContent = 'Mostrar Guía de Talles';
            } else {
                guide.classList.add('active');
                toggleText.textContent = 'Ocultar Guía de Talles';
            }
        }


        // --- 7. INICIALIZACIÓN DE GOOGLE MAPS ---

        // **FUNCIÓN CRÍTICA CORREGIDA:** Inicializa el mapa de Google Maps.
        function initMap() {
            // Coordenadas de ejemplo para Tarragona (cerca de Tarraco Arena)
            const tarragonaLocation = { lat: 41.119, lng: 1.259 };
            
            const map = new google.maps.Map(document.getElementById('contactMap'), {
                zoom: 16,
                center: tarragonaLocation,
                mapId: "SYMF_PRINT_MAP", // ID de estilo de mapa personalizado
                streetViewControl: false
            });

            // Eliminar el loader después de cargar el mapa
            document.getElementById('mapLoader').style.display = 'none';

            // Marcador en la ubicación
            new google.maps.Marker({
                position: tarragonaLocation,
                map: map,
                title: 'SYMF Print - Taller y Showroom'
            });
        }
    </script>
</body>
</html>
